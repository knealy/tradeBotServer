{
    "TopstepX_System": {
      "metadata": {
        "version": "2025.11",
        "sourceDocs": [
          "https://project-x-py.readthedocs.io/en/latest/",
          "https://help.topstep.com/en/articles/8284204-what-is-the-maximum-loss-limit"
        ],
        "description": "Comprehensive system schema for Topstep / TopstepX prop firm integration."
      },
      "account_types": {
        "evaluation": {
          "name": "Trading Combine",
          "starting_balances": [50000, 100000, 150000],
          "profit_targets": {
            "50000": 3000,
            "100000": 6000,
            "150000": 9000
          },
          "daily_loss_limit": {
            "50000": 1000,
            "100000": 2000,
            "150000": 3000
          },
          "maximum_loss_limit": {
            "50000": 2000,
            "100000": 3000,
            "150000": 4500
          },
          "consistency_target": "Best single day profit < 50% of total profit target.",
          "evaluation_pass_rules": [
            "Reach profit target",
            "No daily or maximum loss limit violation",
            "Meet consistency rule",
            "Minimum 5 active trading days"
          ],
          "drawdown_model": {
            "description": "Trailing drawdown (Maximum Loss Limit) that adjusts only upward with new EOD highs.",
            "formula": "max_loss_threshold = highest_EOD_balance - maximum_loss_limit",
            "example": {
              "account_start": 50000,
              "highest_EOD_balance": 50500,
              "maximum_loss_limit": 2000,
              "max_loss_threshold": 48500,
              "comment": "Violation occurs if end-of-day balance â‰¤ 48,500"
            }
          }
        },
        "express_funded": {
          "description": "Stage 2: Funded (simulated) account after Combine success.",
          "rules": {
            "same_MLL": true,
            "MLL_based_on": "highest_end_of_day_balance",
            "EOD_only": true,
            "daily_loss_limit": "Same as evaluation",
            "payouts": {
              "benchmark_days_required": 5,
              "initial_cap": 5000,
              "split": "50% trader until cap, then 100%"
            }
          }
        },
        "live_funded": {
          "description": "Fully live account with real capital.",
          "rules": {
            "daily_loss_limit_intraday": true,
            "MLL_after_first_payout": 0,
            "payout_split": {
              "up_to_10k": "100%",
              "above_10k": "90% trader / 10% Topstep"
            },
            "protective_stop_required": true
          }
        }
      },
      "data_tracking": {
        "required_fields": [
          "account_id",
          "account_type",
          "current_balance",
          "starting_balance",
          "highest_EOD_balance",
          "open_positions",
          "realised_PnL",
          "unrealised_PnL",
          "commissions",
          "fees",
          "timestamp_last_update"
        ],
        "realtime_computation": {
          "net_PnL_formula": "(realised_PnL + unrealised_PnL) - (commissions + fees)",
          "EOD_update_logic": "If current_balance > highest_EOD_balance, set new highest_EOD_balance.",
          "trailing_drawdown_formula": "drawdown_threshold = highest_EOD_balance - MLL_value",
          "violation_condition": "current_balance <= drawdown_threshold"
        }
      },
      "bot_logic": {
        "risk_control": {
          "max_daily_risk": "Must not exceed daily_loss_limit.",
          "intraday_monitoring": "Stop trading if unrealised_loss >= 80% of daily limit.",
          "EOD_check": "Recalculate highest_EOD_balance and MLL threshold."
        },
        "position_sizing": {
          "method": "Dynamic risk-based sizing using ATR or fixed-dollar risk model.",
          "example": {
            "account_balance": 150000,
            "risk_per_trade_percent": 0.25,
            "tick_value": 2.0,
            "stop_distance_ticks": 40,
            "contracts": "(account_balance * (risk_per_trade_percent / 100)) / (stop_distance_ticks * tick_value)"
          }
        },
        "compliance_hooks": [
          "flatten_positions_on_violation",
          "pause_trading_after_daily_limit",
          "update_MLL_on_EOD_close",
          "report_trade_stats_daily"
        ],
        "statistics": {
          "tracked_metrics": [
            "win_rate",
            "average_win",
            "average_loss",
            "max_drawdown",
            "profit_factor",
            "expectancy",
            "roi",
            "sharpe_ratio"
          ],
          "formulas": {
            "profit_factor": "sum(wins) / abs(sum(losses))",
            "expectancy": "((avg_win * win_rate) - (avg_loss * (1 - win_rate)))"
          }
        }
      },
      "sdk_methods": {
        "base_module": "projectx",
        "account": {
          "functions": [
            "get_accounts()",
            "get_account_info(account_id)",
            "get_balance(account_id)",
            "get_positions(account_id)"
          ]
        },
        "market_data": {
          "functions": [
            "get_historical_data(symbol, timeframe, bars)",
            "subscribe_quotes(symbol)"
          ],
          "data_freshness": {
            "bypass_cache_threshold": "bars <= 5 && timeframe in ['1m','5m']"
          }
        },
        "orders": {
          "functions": [
            "get_order_history(account_id, start, end)",
            "place_order(account_id, side, symbol, qty, price=None, order_type='market')",
            "cancel_order(order_id)",
            "trail_stop_order(account_id, side, qty, trail_amount)"
          ],
          "example": {
            "trail_stop": "place_order('BUY', 'MNQ', qty=1, order_type='trailing', trail_amount=25.00)"
          }
        },
        "custom_realtime_tracking": {
          "goal": "If REST endpoints do not expose live account metrics, build custom state cache updated per tick.",
          "method": [
            "1. Track current unrealised_PnL via live quotes.",
            "2. Add realised_PnL after each filled order.",
            "3. Update balance = starting_balance + realised_PnL + unrealised_PnL.",
            "4. On EOD, update highest_EOD_balance."
          ]
        }
      },
      "sample_account_state": {
        "account_id": 13619274,
        "account_name": "150KTC-V2-14334-61291336",
        "account_type": "evaluation",
        "starting_balance": 150000,
        "highest_EOD_balance": 152250.75,
        "current_balance": 151875.50,
        "maximum_loss_limit": 4500,
        "drawdown_threshold": 147750.75,
        "EOD_status": "Compliant",
        "open_positions": [
          {
            "symbol": "MNQZ25",
            "qty": 2,
            "avg_entry": 25295.75,
            "last_price": 25308.50,
            "unrealised_PnL": 127.50
          }
        ],
        "PnL_summary": {
          "realised": 340.25,
          "unrealised": 127.50,
          "commissions": 12.00,
          "fees": 4.50,
          "net_PnL": 451.25
        }
      }
    }
  }
  